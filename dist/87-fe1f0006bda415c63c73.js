webpackJsonp([87],{853:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,i,d=(a(93),a(92)),u=l(d),s=(a(70),a(69)),c=l(s),o=(a(46),a(42)),f=l(o),p=(a(45),a(44)),m=l(p),h=(a(30),a(29)),y=l(h),v=(a(128),a(58)),g=l(v),E=(a(11),a(10)),I=l(E),b=(a(17),a(19)),x=l(b),D=a(3),w=l(D),C=a(4),k=l(C),R=a(6),S=l(R),O=a(5),V=l(O),q=(a(25),a(24)),A=l(q),N=a(1),T=l(N),_=a(2),P=(l(_),a(16)),F=[],z=(n=(0,P.connect)(function(e){var t=e.activity,a=e.loading;return{activity:t,loading:a.models.activity}}),r=A.default.create(),n(i=r(i=function(e){function t(){(0,k.default)(this,t);for(var a=arguments.length,l=Array(a),n=0;n<a;n++)l[n]=arguments[n];var r=(0,S.default)(this,e.call.apply(e,[this].concat(l)));return r.onInputChange=function(e){r.setState({searchText:e.target.value})},r.onSearch=function(){var e=r.state.searchText,t=new RegExp(e,"gi");r.setState({filterDropdownVisible:!1,filtered:!!e,list:F.map(function(e){var a=e.title.match(t);return a?(0,w.default)({},e,{title:T.default.createElement("span",null,e.title.split(t).map(function(e,t){return t>0?[T.default.createElement("span",{className:"highlight"},a[0]),e]:e}))}):null}).filter(function(e){return!!e})})},F=r.props.activity.list,r.state={filterDropdownVisible:!1,searchText:"",filtered:!1,list:F,tag:""},r}return(0,V.default)(t,e),t.prototype.componentWillReceiveProps=function(e){!this.state.list.length!==e.activity.list.length&&(this.setState({list:e.activity.list}),F=e.activity.list)},t.prototype.deleteOrRecover=function(e){var t=this.props.dispatch;t({type:"activity/deleteOrRecoverActivity",payload:{activity:e}})},t.prototype.createActivity=function(e){e.preventDefault();var t=this.props,a=t.dispatch,l=t.form;l.validateFields(function(e,t){e||(t.tag||(delete t.dateRange,delete t.codeInvalidDate),t.dateRange&&(t.startDate=t.dateRange[0].startOf("day").toDate(),t.endDate=t.dateRange[1].endOf("day").toDate(),delete t.dateRange),t.codeInvalidDate&&(t.codeInvalidDate=t.codeInvalidDate.endOf("day").toDate()),a({type:"activity/createActivity",payload:t}))})},t.prototype.tagChange=function(e){this.setState({tag:e.target.value})},t.prototype.render=function(){var e=this,t=[{title:"\u6d3b\u52a8\u540d\u79f0",dataIndex:"title",key:"title",filterDropdown:T.default.createElement("div",{className:"custom-filter-dropdown"},T.default.createElement(x.default,{ref:function(t){return e.searchInput=t},placeholder:"Search name",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onSearch}),T.default.createElement(I.default,{type:"primary",onClick:this.onSearch},"Search")),filterDropdownVisible:this.state.filterDropdownVisible,filterIcon:T.default.createElement(g.default,{type:"filter",style:{color:this.state.filtered?"#108ee9":"#aaa"}}),onFilterDropdownVisibleChange:function(t){return e.setState({filterDropdownVisible:t},function(){return e.searchInput.focus()})}},{title:"\u4ef7\u683c",dataIndex:"price",key:"price"},{title:"\u8ffd\u4e66\u5e01",dataIndex:"currency",key:"currency"},{title:"\u8ffd\u4e66\u5238",dataIndex:"voucher",key:"voucher"},{title:"\u6709\u6548\u671f(\u5929)",key:"expiration",dataIndex:"expiration"},{title:"\u5151\u6362\u6b21\u6570",key:"usedNum",dataIndex:"usedNum"},{title:"\u64cd\u4f5c",key:"operation",width:100,render:function(t,a,l){return T.default.createElement(y.default,{title:a.status?"\u786e\u5b9a\u5220\u9664?":"\u786e\u5b9a\u6062\u590d?",onConfirm:function(){return e.deleteOrRecover(a,l)}},T.default.createElement("a",null,a.status?"\u5220\u9664":"\u6062\u590d"))}}],a={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:12}}},l=this.props.form.getFieldDecorator;return T.default.createElement("div",{className:"content-inner"},T.default.createElement("div",null,T.default.createElement(A.default,{onSubmit:this.createActivity.bind(this)},T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u6d3b\u52a8\u540d\u79f0"}),l("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6d3b\u52a8\u540d\u79f0\uff01"}]})(T.default.createElement(x.default,null))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u4ef7\u683c(\u5143)"}),l("price",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ef7\u683c\uff01"}]})(T.default.createElement(m.default,{style:{width:"200px"}}))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u8ffd\u4e66\u5e01"}),l("currency",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8ffd\u4e66\u5e01\uff01"}]})(T.default.createElement(m.default,{style:{width:"200px"}}))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u8ffd\u4e66\u5377"}),l("voucher",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8ffd\u4e66\u5377\uff01"}]})(T.default.createElement(m.default,{style:{width:"200px"}}))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u6709\u6548\u671f(\u5929)"}),l("expiration",{initialValue:45,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6709\u6548\u671f\uff01"}]})(T.default.createElement(m.default,{style:{width:"200px"}}))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u6d3b\u52a8\u7c7b\u578b"}),l("type",{initialValue:"0"})(T.default.createElement(f.default,null,T.default.createElement(f.default.Option,{value:"0"},"\u9ed8\u8ba4"),T.default.createElement(f.default.Option,{value:"1"},"\u540c\u4e00\u6d3b\u52a8\u7528\u6237\u5151\u6362\u4e00\u6b21")))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u6d3b\u52a8\u6807\u8bb0"}),l("tag",{})(T.default.createElement(x.default,{placeholder:"\u7528\u4e8e\u5151\u6362\u7801\u4ece\u670d\u52a1\u7aef\u83b7\u53d6\uff0c\u5e76\u7531\u670d\u52a1\u7aef\u81ea\u52a8\u751f\u6210",onChange:this.tagChange.bind(this)}))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u6d3b\u52a8\u65e5\u671f",style:{display:this.state.tag?"block":"none"}}),l("dateRange",{rules:this.state.tag?[{required:!0,message:"\u8bf7\u8f93\u5165\u6d3b\u52a8\u65e5\u671f\uff01"}]:[]})(T.default.createElement(c.default.RangePicker,null))),T.default.createElement(A.default.Item,(0,w.default)({},a,{label:"\u5151\u6362\u7801\u5931\u6548\u65e5\u671f",style:{display:this.state.tag?"block":"none"}}),l("codeInvalidDate",{rules:this.state.tag?[{required:!0,message:"\u8bf7\u8f93\u5165\u5151\u6362\u7801\u5931\u6548\u65e5\u671f\uff01"}]:[]})(T.default.createElement(c.default,null))),T.default.createElement(A.default.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:14,offset:6}}},T.default.createElement(I.default,{type:"primary",htmlType:"submit",size:"large"},"\u6dfb\u52a0")))),T.default.createElement(u.default,{size:"small",bordered:!0,columns:t,dataSource:this.state.list,rowKey:function(e){return e._id},loading:this.props.loading}))},t}(T.default.Component))||i)||i);t.default=z,e.exports=t.default}});